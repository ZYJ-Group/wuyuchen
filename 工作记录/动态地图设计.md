# 周报

## 动态地图模块设计

为适配空地协同场景下无人机 (UAV) 的实时检测数据接入需求，本周完成了**分层式动态栅格地图（Layered Occupancy Grid Map）** 架构的设计与初步实现。整体结构参考 ROS navigation 中的多层 costmap，包括：

- **Static Map Layer（静态环境层）**
- **Dynamic Obstacle Layer（动态障碍层）**

---

## 1. 静态地图层

静态层用于加载事先构建的全局环境地图，表示长期不变的结构性障碍物。

<img src="https://github.com/ZYJ-Group/wuyuchen/blob/main/%E5%91%A8%E5%B7%A5%E4%BD%9C/track_image5.png" width="400">

---

## 2. 动态地图层

动态层实时接收 UAV 发送的检测结果，记录临时障碍物和语义目标，并支持随时间更新和清除。

<img src="https://github.com/ZYJ-Group/wuyuchen/blob/main/%E5%91%A8%E5%B7%A5%E4%BD%9C/%E5%8A%A8%E6%80%81%E5%9C%B0%E5%9B%BE.png" width="400">

---

## 3. 动态层处理逻辑

### ● 安全膨胀（Safety Inflation）

对 UAV 检测出的障碍物执行代价膨胀处理：

- 核心区域：完全不可通行（cost = 254）
- 周边缓冲区：随距离衰减，降低导航风险
- 实现方式：
  - OpenCV **形态学膨胀（dilate）**
  - 或基于圆盘卷积的膨胀核

---

### ● 语义代价值（Semantic Cost）

根据 YOLO 分类结果设置不同代价：

| 语义类别 | 代价 Cost | 说明 |
|---------|-----------|------|
| car     | 254       | 不可通行障碍 |
| puddle  | 180       | 高代价区域，可缓慢绕行或减速 |

---

## 4. 模块化结构实现

本周完成如下功能模块：

### ✔ `DynamicOccupancyGridMap` 类  
维护动态层：接收 UAV 目标、更新代价、执行时间衰减清除。

### ✔ 静态层 + 动态层融合  
动态层作为覆盖层叠加到静态层，供全局/局部规划器实时读取。

### ✔ 规划器适配  
原 C++ 规划器从读取 PNG → 改为读取 “静态 + 动态” 融合后的代价地图，实现动态避障。

---



